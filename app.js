(function(){"use strict";const VERSION="v2.14.5";const STAMP=(new Date()).toISOString();const uid=()=> "id-"+Math.random().toString(36).slice(2,9);const todayYMD=()=> (new Date()).toISOString().slice(0,10);const KEY="synergy_store_"+VERSION;const storeGet=()=>{try{let t=localStorage.getItem(KEY);return t?JSON.parse(t):null;}catch(_){return null}};const YEAR=(new Date()).getFullYear(),LAST=YEAR-1;function mkCase(y,seq,p){let b={id:uid(),fileNumber:"INV-"+y+"-"+("00"+seq).slice(-3),title:"",organisation:"",companyId:"C-001",investigatorEmail:"",investigatorName:"",status:"Planning",priority:"Medium",notes:[],tasks:[],folders:{General:[]}};Object.assign(b,p||{});return b}const SEED=()=>({me:{name:"Admin",email:"admin@synergy.com",role:"Admin"},users:[{name:"Admin",email:"admin@synergy.com",role:"Admin"},{name:"Alex Ng",email:"alex@synergy.com",role:"Investigator"},{name:"Priya Menon",email:"priya@synergy.com",role:"Investigator"},{name:"Chris Rice",email:"chris@synergy.com",role:"Reviewer"}],companies:[{id:"C-001",name:"Sunrise Mining Pty Ltd",folders:{General:[]}}, {id:"C-002",name:"City of Melbourne",folders:{General:[]}}, {id:"C-003",name:"Queensland Health (Metro North)",folders:{General:[]}}],contacts:[{id:uid(),name:"Alex Ng",email:"alex@synergy.com",companyId:"C-001"},{id:uid(),name:"Priya Menon",email:"priya@synergy.com",companyId:"C-003"},{id:uid(),name:"Chris Rice",email:"chris@synergy.com",companyId:"C-002"}],cases:[mkCase(LAST,101,{title:"Safety complaint â€“ workshop",organisation:"Sunrise Mining Pty Ltd",companyId:"C-001",investigatorEmail:"alex@synergy.com",investigatorName:"Alex Ng",status:"Closed"}),mkCase(LAST,102,{title:"Bullying allegation â€“ IT",organisation:"City of Melbourne",companyId:"C-002",investigatorEmail:"priya@synergy.com",investigatorName:"Priya Menon",status:"Closed"}),mkCase(YEAR,1,{title:"Bullying complaint in Finance",organisation:"Sunrise Mining Pty Ltd",companyId:"C-001",investigatorEmail:"alex@synergy.com",investigatorName:"Alex Ng",status:"Investigation",priority:"High"}),mkCase(YEAR,2,{title:"Sexual harassment allegation at Brisbane site",organisation:"Queensland Health (Metro North)",companyId:"C-003",investigatorEmail:"priya@synergy.com",investigatorName:"Priya Menon",status:"Planning"}),mkCase(YEAR,3,{title:"Misconduct â€“ data exfiltration",organisation:"City of Melbourne",companyId:"C-002",investigatorEmail:"chris@synergy.com",investigatorName:"Chris Rice",status:"Evidence Review"})],events:[{id:uid(),title:"Interview planning",date:YEAR+"-08-06",start:"09:00",end:"10:00",type:"Appointment",location:"HQ",ownerEmail:"alex@synergy.com",caseId:null},{id:uid(),title:"Evidence review",date:YEAR+"-08-13",start:"15:00",end:"16:00",type:"Appointment",location:"HQ",ownerEmail:"priya@synergy.com",caseId:null}],notifications:[]});const DATA=storeGet()||SEED();const save=()=>{try{localStorage.setItem(KEY,JSON.stringify(DATA));}catch(_){}};const App={state:{route:"dashboard",cal:{year:(new Date()).getFullYear(),month:(new Date()).getMonth()},calFilterOwner:"all",caseId:null,caseTab:"Details"},set(p){Object.assign(this.state,p); render(); save();},me(){return DATA.me}};function bell(){const unread=(DATA.notifications||[]).filter(n=>n.unread).length;return '<button class="bell" data-act="route" data-arg="dashboard">'+(unread?'<span class="dot">'+unread+'</span>':'')+'ðŸ””</button>'}function Topbar(){return '<div class="topbar"><div class="brand">Synergy CRM</div><div class="sp"></div>'+bell()+'<span class="badge">Soft Stable '+VERSION+'</span></div>'}function Sidebar(a){const items=[["dashboard","Dashboard"],["calendar","Calendar"],["cases","Cases"],["contacts","Contacts"],["companies","Companies"],["documents","Documents"],["resources","Resources"],["admin","Admin"]];return '<aside class="sidebar"><h3>Investigations</h3><ul class="nav">'+items.map(([r,l])=>'<li '+(a===r?'class="active"':'')+' data-act="route" data-arg="'+r+'">'+l+'</li>').join("")+'</ul></aside>'}function Shell(content,active){return Topbar()+'<div class="shell">'+Sidebar(active)+'<main class="main">'+content+'</main></div><div id="boot">Ready ('+VERSION+')</div>'}function Dashboard(){let rows=DATA.cases.map(c=>'<tr><td>'+c.fileNumber+'</td><td>'+c.organisation+'</td><td>'+c.investigatorName+'</td><td><span class="chip status-'+c.status.replace(/ /g,"\\ ")+'">'+c.status+'</span></td><td class="right"><button class="btn light" data-act="openCase" data-arg="'+c.id+'">Open</button></td></tr>').join(''); if(!rows) rows='<tr><td colspan="5">No cases</td></tr>'; const table='<table><thead><tr><th>Case ID</th><th>Company</th><th>Investigator</th><th>Status</th><th></th></tr></thead><tbody>'+rows+'</tbody></table>'; const notif='<div class="card"><h3>Calendar updates (Admin)</h3><div class="muted">No notifications</div></div>'; return Shell('<div class="card"><h3>Welcome</h3><div>Timestamp: '+STAMP+'</div></div><div class="section"><header><h3 class="section-title">Active Cases</h3></header>'+table+'</div>'+notif,"dashboard")}function monthMatrix(y,m){const first=new Date(y,m,1);const start=new Date(first);start.setDate(first.getDate()-((first.getDay()+6)%7));const cells=[];for(let i=0;i<42;i++){const d=new Date(start);d.setDate(start.getDate()+i);cells.push(d)}return cells}function Calendar(){const y=App.state.cal.year,m=App.state.cal.month;const mat=monthMatrix(y,m);const evs=DATA.events.filter(e=>{const dt=new Date(e.date);return dt.getMonth()===m&&dt.getFullYear()===y});const by=evs.reduce((a,e)=>((a[e.date]=a[e.date]||[]).push(e),a),{});let grid='';for(const d of mat){const ymd=d.toISOString().slice(0,10),other=d.getMonth()!==m;grid+='<div class="cal-cell'+(other?' muted':'')+'"><div class="cal-date">'+d.getDate()+'</div>'; (by[ymd]||[]).forEach(ev=>{grid+='<span class="ev" data-act="noop" title="'+ev.title+'">'+ev.title+'</span>'}); grid+='</div>'} const head='<div class="cal-head"><div><button class="btn light" data-act="prevMonth">â—€</button> <button class="btn light" data-act="today">Today</button> <button class="btn light" data-act="nextMonth">â–¶</button></div><div style="font-weight:700">'+new Date(y,m,1).toLocaleString(undefined,{month:"long",year:"numeric"})+'</div><div></div></div>'; const cal='<div class="cal">'+head+'<div class="cal-grid">'+grid+'</div></div>'; return Shell('<div class="section"><header><h3 class="section-title">Calendar</h3></header>'+cal+'</div>',"calendar")}function Cases(){let rows='';for(const cc of DATA.cases){rows+='<tr><td>'+cc.fileNumber+'</td><td>'+cc.title+'</td><td>'+cc.organisation+'</td><td>'+cc.investigatorName+'</td><td><span class="chip status-'+cc.status.replace(/ /g,"\\ ")+'">'+cc.status+'</span></td><td class="right"><button class="btn light" data-act="openCase" data-arg="'+cc.id+'">Open</button></td></tr>'} return Shell('<div class="section"><header><h3 class="section-title">Cases</h3></header><table><thead><tr><th>Case ID</th><th>Title</th><th>Organisation</th><th>Investigator</th><th>Status</th><th></th></tr></thead><tbody>'+rows+'</tbody></table></div>','cases')}function CasePage(){const id=App.state.caseId;const cs=DATA.cases.find(c=>c.id===id);if(!cs) return Shell('<div class="card">Case not found</div>','cases'); let details='<div class="grid cols-2"><div><label>Case ID</label><input class="input" value="'+cs.fileNumber+'"></div><div><label>Organisation</label><input class="input" value="'+cs.organisation+'"></div><div><label>Title</label><input class="input" value="'+cs.title+'"></div></div>'; return Shell('<div class="card"><div style="display:flex;align-items:center;gap:8px"><h2>Case '+cs.fileNumber+'</h2><div class="sp"></div><button class="btn light" data-act="route" data-arg="cases">Back to Cases</button></div></div><div class="section">'+details+'</div>','cases')}function Contacts(){return Shell('<div class="card">Contacts placeholder</div>','contacts')}function Companies(){return Shell('<div class="card">Companies placeholder</div>','companies')}function Documents(){return Shell('<div class="card">Documents placeholder</div>','documents')}function Resources(){return Shell('<div class="card">Resources placeholder</div>','resources')}function Admin(){return Shell('<div class="card">Admin placeholder</div>','admin')}function render(){const r=App.state.route,el=document.getElementById('app');if(r==='dashboard')el.innerHTML=Dashboard();else if(r==='calendar')el.innerHTML=Calendar();else if(r==='cases')el.innerHTML=Cases();else if(r==='case')el.innerHTML=CasePage();else if(r==='contacts')el.innerHTML=Contacts();else if(r==='companies')el.innerHTML=Companies();else if(r==='documents')el.innerHTML=Documents();else if(r==='resources')el.innerHTML=Resources();else if(r==='admin')el.innerHTML=Admin();else el.innerHTML=Dashboard()}document.addEventListener('click',e=>{let t=e.target;while(t&&t!==document&&!t.getAttribute('data-act'))t=t.parentNode;if(!t||t===document) return;const act=t.getAttribute('data-act'),arg=t.getAttribute('data-arg'); if(act==='route'){App.set({route:arg});return;} if(act==='openCase'){App.set({route:'case',caseId:arg});return;} if(act==='prevMonth'){const m=App.state.cal.month-1;const d=new Date(App.state.cal.year,m,1);App.set({cal:{year:d.getFullYear(),month:d.getMonth()}});return;} if(act==='nextMonth'){const m=App.state.cal.month+1;const d=new Date(App.state.cal.year,m,1);App.set({cal:{year:d.getFullYear(),month:d.getMonth()}});return;} if(act==='today'){const d=new Date();App.set({cal:{year:d.getFullYear(),month:d.getMonth()}});return;} });document.addEventListener('DOMContentLoaded',()=>{App.set({route:'dashboard'})});})();